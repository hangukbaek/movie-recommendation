<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ ì˜í™” ì¶”ì²œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cafe24+Ssurround&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script defer src="main.js"></script>
  <script defer src="weeklyRank.js"></script>
  <script defer src="dailyRank.js"></script>
  <script defer src="genre.js"></script>
  <script defer src="toppeople.js"></script>
  <script defer src="upcoming.js"></script>
  <script defer src="searchResult.js"></script>
</head>

<body>
  <header>
    <div class="header-left">
      <h1 id="search-title" onclick="window.location.reload();">ğŸ¬ ì˜¤ëŠ˜ì˜ ì˜í™” ì¶”ì²œ</h1>
    </div>

    <div class="header-center">
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="ì˜í™” ì œëª©ì„ ê²€ìƒ‰í•˜ì„¸ìš”" />
        <button id="search-button">ğŸ”</button>
        <div id="search-history" class="search-history" style="display: none;"></div>
      </div>
    </div>

    <div class="header-right">
      <span id="login-status" style="color: white; margin-right: 10px;"></span>
      <button class="btn-login" id="googleLoginBtn">ë¡œê·¸ì¸</button>
      <button class="btn-logout" id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
      <button class="btn-mypage" id="myPageBtn" style="display:none;">ë§ˆì´í˜ì´ì§€</button>
    </div>
  </header>

  <!-- ì¥ë¥´ ë²„íŠ¼ -->
  <section class="genre-buttons">
    <button>ì•¡ì…˜</button>
    <button>ì½”ë¯¸ë””</button>
    <button>SF</button>
    <button>ê³µí¬</button>
    <button>ìŠ¤ë¦´ëŸ¬</button>
    <button>ë¡œë§¨ìŠ¤</button>
    <button>ìŒì•…</button>
    <button>ì• ë‹ˆë©”ì´ì…˜</button>
    <button>ë‹¤íë©˜í„°ë¦¬</button>
    <button>íŒíƒ€ì§€</button>
  </section>

  <div id="genre-movie-container" class="hidden"></div>
  <!-- ê²€ìƒ‰ ê²°ê³¼ ì»¨í…Œì´ë„ˆ -->
  <div id="search-result-container" class="container" style="display:none; margin-top: 20px;"></div>

  <!-- ì¥ë¥´ë³„ ì˜í™” ìŠ¬ë¼ì´ë“œ -->
  <div class="container hidden" id="genre-movie-container" style="margin-top: 20px;"></div>

  <!-- ì£¼ê°„ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ -->
  <h2 class="section-title">ì£¼ê°„ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ìˆœìœ„</h2>
  <div class="slider-wrapper">
    <button id="slide-left">â—€</button>
    <div id="hot-movie-list"></div>
    <button id="slide-right">â–¶</button>
  </div>

  <div class="slider-wrapper">
    <div class="slider-container">
      <!-- ì´ê³³ì— JSë¡œ ì¹´ë“œë“¤ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
      <div id="movies-container" class="slider-track"></div>
    </div>
  </div>

  <!-- ê°œë´‰ ì˜ˆì •ì‘ -->
  <section class="upcoming-wrapper">
    <h2 class="section-title">ì´ë²ˆ ë‹¬ ê°œë´‰ ì˜ˆì •ì‘</h2>
    <div id="week-tab-buttons" class="week-tabs"></div>
    <div id="upcoming-week-container"></div>
  </section>

  <!-- ì²œë§Œ ê±°ì¥ë“¤ -->
  <h2 class="section-title">ì²œë§Œ ê±°ì¥ë“¤ ì‘í’ˆ ë‘˜ëŸ¬ë³´ê¸°</h2>
  <div class="person-tabs">
    <button class="person-tab active" data-role="director">ê°ë…</button>
    <button class="person-tab" data-role="actor">ë°°ìš°</button>
  </div>

  <!-- ì¸ë¬¼ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
  <div class="person-container">
    <div id="person-list" class="person-list"></div>
  </div>

  <!-- ì¸ë¬¼ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="person-modal" class="modal hidden">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h3 id="modal-name"></h3>
      <div class="modal-top">
        <img id="modal-profile" alt="í”„ë¡œí•„ ì‚¬ì§„" />
        <div id="modal-bio" class="modal-bio">
          <p>ì•½ë ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
      <h4>í•„ëª¨ê·¸ë˜í”¼</h4>
      <div id="modal-movies" class="modal-movie-list"></div>
    </div>
  </div>

  <!-- ì˜í™” ìƒì„¸ íŒì—… -->
  <div id="movie-popup" class="movie-popup" style="display:none;">
    <div class="popup-content">
      <button id="popup-close" class="popup-close">âœ–</button>
      <div id="popup-body"></div>
    </div>
  </div>

  <!-- ë¡œê·¸ì¸ ë° í† í° ì²˜ë¦¬ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const loginBtn = document.getElementById("googleLoginBtn");
      if (loginBtn) {
        loginBtn.addEventListener("click", () => {
          const currentPath = window.location.pathname + window.location.search;
          window.location.href = `/auth/google?redirect=${encodeURIComponent(currentPath)}`;
        });
      }

      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token");

      if (token) {
        localStorage.setItem("token", token);
        console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ: JWTê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");

        urlParams.delete("token");
        const newUrl =
          window.location.pathname +
          (urlParams.toString() ? "?" + urlParams.toString() : "");
        history.replaceState({}, "", newUrl);
        location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ìƒíƒœ ë°˜ì˜
      }
    });
  </script>
</body>

</html>